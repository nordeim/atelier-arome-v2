# Remedial Implementation Plan: JavaScript Feature Port

## Overview
Port remaining JavaScript features from [main.js](file:///home/project/atelier-arome/main.js) (1,940 lines) to Next.js using React patterns: custom hooks, Zustand stores, and modular components.

---

## Phase 1: Custom Hooks Foundation

### [NEW] `src/hooks/use-scroll.ts`
Custom hook for scroll-based effects (header shadow, back-to-top, active nav).

```typescript
export function useScroll() {
  // State for scroll position, header scrolled, active section
  // Returns { scrollY, isScrolled, activeSection }
}
```

### [NEW] `src/hooks/use-intersection.ts`
Intersection Observer hook for scroll animations.

```typescript
export function useIntersection(options?: IntersectionObserverInit) {
  // Returns { ref, isInView }
}
```

### [NEW] `src/hooks/use-reduced-motion.ts`
Respects user's reduced motion preference.

```typescript
export function useReducedMotion() {
  // Returns boolean for reduced motion preference
}
```

---

## Phase 2: Toast Notification System

### [NEW] `src/stores/toast-store.ts`
Zustand store for toast notifications matching [main.js](file:///home/project/atelier-arome/main.js) lines 1783-1811.

```typescript
interface Toast {
  id: string;
  message: string;
  type: 'info' | 'success' | 'warning' | 'error';
}

export const useToastStore = create<ToastState>((set) => ({
  toasts: [],
  showToast: (message, type) => { /* add toast, auto-remove after 5s */ },
  removeToast: (id) => { /* remove by id */ },
}));
```

### [NEW] `src/components/ui/toast.tsx`
Toast component matching `.toast` CSS classes in styles.css.

---

## Phase 3: Header Scroll Effects

### [MODIFY] [src/components/layout/header.tsx](file:///home/project/atelier-arome/atelier-arome-web/src/components/layout/header.tsx)
Add scroll effect logic from [main.js](file:///home/project/atelier-arome/main.js) lines 1669-1676.

**Changes:**
- Add `useScroll` hook
- Toggle `.header.scrolled` class based on `scrollY > 20`
- Implement smooth scroll for nav links (lines 1757-1775)

---

## Phase 4: Cart Drawer (Vial)

### [NEW] `src/components/cart/vial-drawer.tsx`
Slide-out cart drawer matching `.vial-drawer` CSS classes.

**Features from [main.js](file:///home/project/atelier-arome/main.js) lines 739-978:**
- Cart item list with quantity controls
- Empty state with "⚱ Your collection vial awaits"
- Total calculation
- Dispatch/checkout button
- Keyboard (Escape) to close
- Focus trapping

### [MODIFY] [src/components/layout/header.tsx](file:///home/project/atelier-arome/atelier-arome-web/src/components/layout/header.tsx)
Connect cart button to open vial drawer.

---

## Phase 5: Scroll Animations

### [NEW] `src/components/ui/animate-in-view.tsx`
Wrapper component using `use-intersection` hook.

```tsx
export function AnimateInView({ children, className }) {
  const { ref, isInView } = useIntersection();
  return (
    <div ref={ref} className={cn(className, isInView && 'in-view')}>
      {children}
    </div>
  );
}
```

### [MODIFY] Section components
Wrap `.essence-card`, `.alchemy-step`, `.manuscript-entry` with `AnimateInView`.

---

## Phase 6: Form Validation & Accessibility

### [MODIFY] [src/components/sections/newsletter-section.tsx](file:///home/project/atelier-arome/atelier-arome-web/src/components/sections/newsletter-section.tsx)
Add validation logic from [main.js](file:///home/project/atelier-arome/main.js) lines 1447-1592:
- Email format validation
- Error state styling (`.correspondence__field--error`)
- Loading state on submit
- Success toast notification

### [NEW] `src/lib/a11y.ts`
Accessibility utilities matching [main.js](file:///home/project/atelier-arome/main.js) A11y object (lines 526-656):
- [announce(message, priority)](file:///home/project/atelier-arome/main.js#578-601) - screen reader announcements
- Focus trap helper

---

## File Structure (New Files)

```
src/
├── hooks/
│   ├── use-scroll.ts          # Scroll position & effects
│   ├── use-intersection.ts    # Intersection observer
│   └── use-reduced-motion.ts  # Motion preference
├── stores/
│   ├── cart-store.ts          # (exists) - verify complete
│   └── toast-store.ts         # NEW - toast notifications
├── components/
│   ├── cart/
│   │   └── vial-drawer.tsx    # NEW - cart drawer
│   └── ui/
│       ├── toast.tsx          # NEW - toast component
│       └── animate-in-view.tsx # NEW - scroll animation wrapper
├── lib/
│   ├── utils.ts               # (exists)
│   └── a11y.ts                # NEW - accessibility utilities
```

---

## Implementation Priority

| Phase | Components | Priority | Est. Tool Calls |
|-------|------------|----------|-----------------|
| 1 | Custom Hooks (3 files) | High | 6 |
| 2 | Toast System (2 files) | High | 5 |
| 3 | Header Effects | High | 4 |
| 4 | Vial Drawer | High | 6 |
| 5 | Scroll Animations | Medium | 4 |
| 6 | Form Validation | Medium | 4 |

**Total Estimated Tool Calls: ~29**

---

## Verification Plan

### Automated Tests
```bash
npm run build  # Verify no TypeScript errors
npm run dev    # Visual verification
```

### Manual Verification
- [ ] Header adds `.scrolled` class on scroll down
- [ ] Toast appears when adding item to cart
- [ ] Vial drawer opens/closes correctly
- [ ] Elements animate in on scroll
- [ ] Form shows validation errors
- [ ] Reduced motion preference respected

---

## CSS Dependencies

### ✅ Existing in [styles.css](file:///home/project/atelier-arome/styles.css)
- `.header.scrolled` (line 332)
- `.toast`, `.toast--success`, `.toast--warning`, `.toast--error` (lines 3411-4135)
- `.vial-drawer`, `.vial-drawer.active`, `.vial-drawer__*` (lines 3313-3971)
- `.correspondence__field--error` (form validation)

### ⚠️ May Need to Add
- Scroll animation classes (`.fade-in-up`, etc.) - The static mockup uses JS-toggled opacity/transform. We can either:
  1. Add CSS classes for reveal animations, OR
  2. Use Tailwind's built-in animation utilities

**Recommendation:** Use Tailwind `animate-` utilities for scroll reveal, avoiding CSS modifications.
